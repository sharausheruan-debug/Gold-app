<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ• | ÙˆÛ•Ø´Ø§Ù†ÛŒ Ú©Û†ØªØ§ÛŒÛŒ</title>
    <style>
        :root { --gold: #d4af37; --bg: #0d0d0d; --card: #1a1a1a; --input-bg: #000; --text: #fff; --up: #00ff88; --down: #ff4d4d; --freeze: #00d4ff; }
        .light-mode { --bg: #f5f5f5; --card: #ffffff; --input-bg: #f0f0f0; --text: #333; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; justify-content: center; min-height: 100vh; align-items: flex-start; transition: 0.3s; }
        .box { background: var(--card); padding: 20px; border-radius: 25px; width: 100%; max-width: 380px; border: 1px solid rgba(212, 175, 55, 0.2); position: relative; box-shadow: 0 10px 40px rgba(0,0,0,0.5); margin-bottom: 20px; }
        .header h2 { color: var(--gold); text-align: center; margin: 0; font-size: 22px; }
        .live-clock { font-size: 11px; color: #666; text-align: center; margin: 5px 0; }
        .status-bar { display: flex; justify-content: space-between; align-items: center; margin: 15px 0; }
        .btn-live { background: var(--gold); color: #000; font-weight: bold; padding: 5px 12px; border-radius: 12px; font-size: 11px; cursor: pointer; border: none; }
        .market-btn { display: flex; align-items: center; gap: 6px; background: rgba(128,128,128,0.1); padding: 5px 12px; border-radius: 12px; border: 1px solid #333; cursor: pointer; }
        .status-dot { width: 7px; height: 7px; border-radius: 50%; }
        .dot-open { background: var(--up); box-shadow: 0 0 5px var(--up); }
        .dot-closed { background: var(--down); box-shadow: 0 0 5px var(--down); }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .full-width { grid-column: span 2; }
        label { display: block; font-size: 10px; color: #888; margin-bottom: 3px; }
        input, select { width: 100%; padding: 10px; border: 1px solid #333; border-radius: 12px; background: var(--input-bg); color: var(--text); font-size: 15px; text-align: center; outline: none; box-sizing: border-box; }
        .results { border-radius: 15px; overflow: hidden; background: rgba(128,128,128,0.05); margin-bottom: 15px; border: 1px solid #333; position: relative; }
        .row { display: flex; justify-content: space-between; padding: 12px 15px; border-bottom: 1px solid #333; }
        .val-iqd { font-weight: bold; font-size: 16px; }
        .val-usd { color: var(--gold); font-size: 11px; display: block; text-align: left; }
        .calc-section { background: rgba(212, 175, 55, 0.03); padding: 15px; border-radius: 15px; border: 1px dashed rgba(212, 175, 55, 0.3); }
        .weight-info { font-size: 10px; color: var(--gold); text-align: center; margin-top: 5px; display: block; }
        .total-box { text-align: center; margin-top: 10px; background: #000; padding: 12px; border-radius: 12px; border: 1px solid var(--up); position: relative; }
        .currency-toggle { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); background: #222; border: 1px solid #444; color: var(--text); border-radius: 8px; padding: 5px; cursor: pointer; font-size: 12px; }
        .days-modal { display: none; position: absolute; top: 100px; left: 30px; right: 30px; background: var(--card); border: 2px solid var(--gold); padding: 15px; border-radius: 20px; z-index: 100; box-shadow: 0 10px 30px rgba(0,0,0,0.8); }
        .days-modal.active { display: block; }
        .freeze-btn { background: #333; border: 1px solid var(--freeze); color: var(--freeze); border-radius: 8px; font-size: 10px; padding: 5px 10px; cursor: pointer; }
        .freeze-active { background: var(--freeze); color: #000; }
        .history-box { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; max-height: 150px; overflow-y: auto; }
        .history-item { font-size: 11px; padding: 8px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

<div class="box">
    <button onclick="document.body.classList.toggle('light-mode')" style="position:absolute; left:15px; top:15px; background:none; border:none; cursor:pointer; font-size:18px;">ğŸŒ“</button>
    <div class="header"><h2>Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ•</h2></div>
    <p id="live-clock" class="live-clock">--:--:--</p>
    
    <div class="status-bar">
        <button id="live-btn" class="btn-live" onclick="fetchGoldPrice()">Live ğŸ”´</button>
        <div style="display: flex; gap: 5px; align-items: center;">
            <button id="freeze-btn" class="freeze-btn" onclick="toggleFreeze()">â„ï¸ Ø¨Û•Ø³ØªÙ†</button>
            <div class="market-btn" onclick="document.getElementById('daysModal').classList.toggle('active')">
                <div id="status-dot" class="status-dot"></div>
                <span id="market-text">Ø¨Û†Ø±Ø³Û•</span>
            </div>
        </div>
    </div>

    <div id="daysModal" class="days-modal">
        <div style="text-align: center; color: var(--gold); font-size: 14px; font-weight: bold; margin-bottom: 10px;">Ø®Ø´ØªÛ•ÛŒ Ø¨Û†Ø±Ø³Û•ÛŒ Ø¬ÛŒÙ‡Ø§Ù†ÛŒ</div>
        <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 6px 0; border-bottom: 1px solid #333;"><span>Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û• - Ù‡Û•ÛŒÙ†ÛŒ</span> <span style="color:var(--up)">Ú©Ø±Ø§ÙˆÛ•ÛŒÛ•</span></div>
        <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 6px 0;"><span>Ø´Û•Ù…Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•</span> <span style="color:var(--down)">Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•</span></div>
        <button onclick="document.getElementById('daysModal').classList.remove('active')" style="width: 100%; margin-top: 10px; background: var(--gold); border: none; border-radius: 10px; cursor: pointer; padding: 8px; font-weight: bold;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>

    <div class="grid">
        <div><label>Ø¦Û†Ù†Ø³Û• <span id="trend"></span></label><input type="number" id="ounce" step="0.01" oninput="update()"></div>
        <div><label>Ù¡Ù Ù  Ø¯Û†Ù„Ø§Ø±</label><input type="number" id="dollar" oninput="autoPremium()"></div>
        <div class="full-width">
            <label>Ù…Û•Ø³Ø±Û•Ù + Ø­Û•ÙˆØ§ÚµÛ• ($) <small style="color:var(--up)">Auto âœ¨</small></label>
            <input type="number" id="premium" oninput="update()">
        </div>
    </div>

    <div class="results">
        <div class="row"><span>Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤:</span><div style="text-align:left;"><span class="val-iqd" id="v24-iqd">0</span><span class="val-usd" id="v24-usd">$0</span></div></div>
        <div class="row" style="border-right: 3px solid var(--gold);"><span>Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡:</span><div style="text-align:left;"><span class="val-iqd" id="v21-iqd">0</span><span class="val-usd" id="v21-usd">$0</span></div></div>
        <div class="row"><span>Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨:</span><div style="text-align:left;"><span class="val-iqd" id="v18-iqd">0</span><span class="val-usd" id="v18-usd">$0</span></div></div>
    </div>

    <div class="calc-section">
        <div class="grid" style="margin: 0; gap: 8px;">
            <div><label>Ú¯Ø±Ø§Ù…</label><input type="number" id="g-weight" placeholder="0" oninput="update()"></div>
            <div><label>Ù…Ø³Ù‚Ø§Úµ</label><input type="number" id="m-weight" placeholder="0" oninput="update()"></div>
            <div><label>Ø­Û•Ù‚ Ø¯Û•Ø³Øª (Ù…Ø³Ù‚Ø§Úµ)</label><input type="number" id="work-cost" value="0" oninput="update()"></div>
            <div><label>Ø¹Û•ÛŒØ§Ø±</label><select id="calc-karat" onchange="update()"><option value="1">Ù¢Ù¤</option><option value="0.875" selected>Ù¢Ù¡</option><option value="0.75">Ù¡Ù¨</option></select></div>
        </div>
        <span id="weight-detail" class="weight-info">Ú©ÛØ´: 0 Ù…Ø³Ù‚Ø§Úµ Ùˆ 0 Ù†Û†Ø¯</span>
        <div class="total-box">
            <button class="currency-toggle" onclick="toggleCurrency()">â‡„</button>
            <span id="total-val" style="color:var(--up); font-size: 18px; font-weight: bold;">0 Ø¯.Ú©</span>
            <div onclick="addToHistory()" style="margin-top: 5px; color:#666; font-size:10px; cursor:pointer;">â• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ø¨Ú©Û•</div>
        </div>
    </div>

    <div id="history-container" class="history-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span style="font-size:10px; color:#888;">Ù„ÛŒØ³ØªÛŒ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª:</span><button onclick="clearHistory()" style="background:none; border:none; color:var(--down); font-size:9px; cursor:pointer;">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button></div>
        <div id="history-list"></div>
    </div>
</div>

<script>
    let isFrozen = false;
    let showInDollar = false;
    let currentTotalIQD = 0;
    let lastPrice = 0;

    function toggleFreeze() {
        isFrozen = !isFrozen;
        const btn = document.getElementById('freeze-btn');
        btn.classList.toggle('freeze-active');
        btn.innerText = isFrozen ? "âœ… Ø¨Û•Ø³ØªØ±Ø§ÙˆÛ•" : "â„ï¸ Ø¨Û•Ø³ØªÙ†";
    }

    function toggleCurrency() {
        showInDollar = !showInDollar;
        displayTotal();
    }

    function autoPremium() {
        if(isFrozen) return;
        const dollar = parseFloat(document.getElementById('dollar').value) || 0;
        let basePremium = 220;
        let diff = (dollar - 148900) / 1000;
        document.getElementById('premium').value = (basePremium + (diff * 2.5)).toFixed(1);
        update();
    }

    async function fetchGoldPrice() {
        if(isFrozen) return;
        try {
            const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT');
            const data = await res.json();
            const price = parseFloat(data.price);
            
            if (price > 0) {
                const trend = document.getElementById('trend');
                if(lastPrice > 0 && price !== lastPrice) {
                    trend.innerHTML = price > lastPrice ? "â–²" : "â–¼";
                    trend.style.color = price > lastPrice ? "var(--up)" : "var(--down)";
                }
                lastPrice = price;
                document.getElementById('ounce').value = price.toFixed(2);
                update();
            }
        } catch (e) { console.log("Fetch error"); }
    }

    function update() {
        const ounce = parseFloat(document.getElementById('ounce').value) || 0;
        const dollar = parseFloat(document.getElementById('dollar').value) || 0;
        const premium = parseFloat(document.getElementById('premium').value) || 0;
        const workCost = parseFloat(document.getElementById('work-cost').value) || 0;
        const exRate = dollar / 100;

        if (ounce > 0 && dollar > 0) {
            // ÙÛ†Ø±Ù…ÙˆÙ„Ø§ÛŒ Ù†ÙˆÛ Ùˆ ÙˆØ±Ø¯ØªØ± - Ù†Ø²ÛŒÚ©ØªØ± Ù„Û• Ù†Ø±Ø®ÛŒ Ø¬ÛŒÙ‡Ø§Ù†ÛŒ
            const gramInUSD = (ounce + premium) / 31.1034768;
            const mithqalInUSD = gramInUSD * 5;
            const m24_raw = mithqalInUSD * exRate;
            
            function setPrice(id, ratio) {
                const exactPrice = m24_raw * ratio;
                const iqd = (Math.round(exactPrice / 250) * 250);
                document.getElementById(id + '-iqd').innerText = iqd.toLocaleString() + " Ø¯.Ú©";
                document.getElementById(id + '-usd').innerText = "$" + (iqd / exRate).toFixed(2);
            }

            setPrice('v24', 1); 
            setPrice('v21', 0.875); 
            setPrice('v18', 0.75);

            const gW = parseFloat(document.getElementById('g-weight').value) || 0;
            const mW = parseFloat(document.getElementById('m-weight').value) || 0;
            const totalM = mW + (gW / 5);
            
            document.getElementById('weight-detail').innerText = `Ú©ÛØ´: ${Math.floor(totalM)} Ù…Ø³Ù‚Ø§Úµ Ùˆ ${Math.round((totalM % 1) * 100)} Ù†Û†Ø¯`;

            const karat = parseFloat(document.getElementById('calc-karat').value);
            currentTotalIQD = (m24_raw * karat * totalM) + (workCost * totalM);
            displayTotal();
        }
    }

    function displayTotal() {
        const dollar = parseFloat(document.getElementById('dollar').value) || 1;
        const exRate = dollar / 100;
        const el = document.getElementById('total-val');
        if (showInDollar) {
            el.innerText = "$" + (currentTotalIQD / exRate).toFixed(2);
        } else {
            el.innerText = (Math.round(currentTotalIQD / 250) * 250).toLocaleString() + " Ø¯.Ú©";
        }
    }

    function addToHistory() {
        const val = document.getElementById('total-val').innerText;
        const weight = document.getElementById('weight-detail').innerText;
        if(currentTotalIQD === 0) return;
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `<span>${weight}</span> <strong>${val}</strong>`;
        document.getElementById('history-list').prepend(item);
    }

    function clearHistory() { document.getElementById('history-list').innerHTML = ''; }

    setInterval(() => {
        document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-GB');
        const d = new Date();
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('market-text');
        if (d.getDay() === 6 || d.getDay() === 0) { 
            dot.className = "status-dot dot-closed"; text.innerText = "Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•"; 
        } else { 
            dot.className = "status-dot dot-open"; text.innerText = "Ú©Ø±Ø§ÙˆÛ•ÛŒÛ•"; 
        }
    }, 1000);

    window.onload = () => {
        document.getElementById('dollar').value = "149000";
        autoPremium();
        fetchGoldPrice();
        setInterval(fetchGoldPrice, 3000);
    };
</script>
</body>
    </html>
