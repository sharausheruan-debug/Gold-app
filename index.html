<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ• | Pro</title>
    <style>
        :root { 
            --gold: #d4af37; --gold-light: #ffcc33; --bg: #0d0d0d; 
            --card: #1a1a1a; --input-bg: #000; --text: #fff; 
            --up: #00ff88; --down: #ff4d4d; --freeze: #00d4ff; 
        }
        .light-mode { --bg: #f5f5f5; --card: #ffffff; --input-bg: #f0f0f0; --text: #333; }
        
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 10px; display: flex; justify-content: center; min-height: 100vh; transition: 0.3s; overflow-x: hidden; }
        
        .box { 
            background: var(--card); padding: 20px; border-radius: 25px; width: 100%; max-width: 380px; 
            border: 1px solid rgba(212, 175, 55, 0.2); position: relative; 
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); 
        }

        #menu-toggle {
            position: absolute; right: 15px; top: 15px; background: none; border: none; 
            color: var(--gold); font-size: 24px; cursor: pointer; z-index: 1001;
        }
        .sidebar {
            position: fixed; top: 0; right: -280px; width: 250px; height: 100%;
            background: var(--card); border-left: 1px solid var(--gold);
            transition: 0.4s; z-index: 1000; padding: 60px 20px; box-shadow: -5px 0 15px rgba(0,0,0,0.5);
        }
        .sidebar.active { right: 0; }
        
        .menu-dropdown { margin-top: 15px; background: rgba(255,255,255,0.05); border-radius: 12px; overflow: hidden; border: 1px solid #333; }
        .dropdown-header-btn { width: 100%; padding: 12px; background: #222; color: var(--gold); border: none; cursor: pointer; font-weight: bold; display: flex; justify-content: center; align-items: center; gap: 8px; outline: none; }
        .dropdown-list { display: none; padding: 5px; background: rgba(0,0,0,0.2); }
        .dropdown-list.show { display: block; }
        
        .setting-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #333; }
        .setting-label { font-size: 13px; color: #fff; }
        .switch { position: relative; display: inline-block; width: 40px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #444; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--up); }
        input:checked + .slider:before { transform: translateX(20px); }

        .sub-btn { display: block; width: 100%; padding: 10px; margin-bottom: 5px; background: transparent; border: 1px solid transparent; color: white; border-radius: 8px; cursor: pointer; text-align: center; font-size: 14px; }
        .sub-btn:hover { background: rgba(212, 175, 55, 0.1); border-color: var(--gold); }
        .sub-btn.active-item { border-color: var(--up); color: var(--up); }

        .header h2 { color: var(--gold); text-align: center; margin: 0; font-size: 24px; font-weight: 800; display: flex; justify-content: center; align-items: center; gap: 10px; }
        .live-clock { font-size: 12px; color: #666; text-align: center; margin: 5px 0 15px; }

        .status-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-live { background: var(--gold); color: #000; font-weight: bold; padding: 6px 14px; border-radius: 12px; font-size: 12px; cursor: pointer; border: none; transition: 0.3s; }
        
        .market-btn { display: flex; align-items: center; gap: 6px; background: rgba(128,128,128,0.1); padding: 6px 12px; border-radius: 12px; border: 1px solid #333; cursor: pointer; }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; }
        .dot-open { background: var(--up); box-shadow: 0 0 8px var(--up); }
        .dot-closed { background: var(--down); box-shadow: 0 0 8px var(--down); }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin: 15px 0; }
        .full-width { grid-column: span 2; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 4px; padding-right: 5px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 15px; background: var(--input-bg); color: var(--text); font-size: 15px; text-align: center; outline: none; box-sizing: border-box; transition: 0.3s; }

        .quick-conv { background: rgba(255, 255, 255, 0.03); padding: 12px; border-radius: 18px; margin-bottom: 15px; border: 1px solid #222; }
        .conv-inputs { display: flex; gap: 8px; align-items: center; }
        .conv-inputs input { padding: 8px; font-size: 13px; border-radius: 10px; }

        .results { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .res-card { background: rgba(128,128,128,0.05); padding: 12px 5px; border-radius: 15px; text-align: center; border: 1px solid #333; }
        .res-card.highlight { border-color: var(--gold); background: rgba(212, 175, 55, 0.05); }
        .res-label { display: block; font-size: 10px; color: var(--gold); margin-bottom: 5px; }
        .res-iqd { display: block; font-weight: bold; font-size: 13px; margin-bottom: 2px; }
        .res-usd { display: block; font-size: 10px; color: #777; }

        .alert-section { background: rgba(0, 212, 255, 0.05); padding: 10px; border-radius: 15px; border: 1px solid rgba(0, 212, 255, 0.2); margin-bottom: 15px; display: flex; align-items: center; gap: 5px; transition: 0.3s; }
        .alert-input { padding: 8px; border-radius: 10px; font-size: 13px; flex-grow: 1; }
        .alert-type-btn { background: #222; border: 1px solid var(--freeze); color: var(--freeze); border-radius: 10px; font-size: 10px; padding: 8px 5px; cursor: pointer; min-width: 60px; }

        .calc-section { background: rgba(212, 175, 55, 0.03); padding: 15px; border-radius: 20px; border: 1px dashed rgba(212, 175, 55, 0.3); margin-top: 10px; }
        .weight-info { font-size: 11px; color: var(--gold); text-align: center; margin-top: 8px; display: block; font-weight: 500; }
        .total-box { text-align: center; margin-top: 12px; background: #000; padding: 15px; border-radius: 15px; border: 1px solid var(--up); position: relative; }
        .currency-toggle { position: absolute; left: 10px; top: 15px; background: #222; border: 1px solid #444; color: var(--text); border-radius: 8px; padding: 6px; cursor: pointer; font-size: 14px; }
        .btn-share { background: rgba(0, 255, 136, 0.1); color: var(--up); border: 1px solid var(--up); border-radius: 10px; padding: 5px 10px; font-size: 11px; cursor: pointer; margin-top: 10px; width: 100%; transition: 0.3s; }
        
        .chart-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 5000; justify-content: center; align-items: center; }
        .chart-modal.active { display: flex; }
        .chart-box { width: 95%; height: 85%; background: #131722; border-radius: 20px; border: 2px solid var(--gold); position: relative; overflow: hidden; }
        .close-chart { position: absolute; top: 15px; left: 15px; background: var(--down); color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; z-index: 5001; font-weight: bold; }
        .chart-btn-icon { background: rgba(212, 175, 55, 0.1); border: 1px solid var(--gold); color: var(--gold); padding: 2px 8px; border-radius: 8px; cursor: pointer; font-size: 16px; }

        .days-modal { display: none; position: absolute; top: 80px; left: 20px; right: 20px; background: var(--card); border: 2px solid var(--gold); padding: 20px; border-radius: 20px; z-index: 100; box-shadow: 0 10px 40px rgba(0,0,0,0.9); }
        .days-modal.active { display: block; }
        .freeze-btn { background: #333; border: 1px solid var(--freeze); color: var(--freeze); border-radius: 10px; font-size: 11px; padding: 6px 12px; cursor: pointer; margin-left: 5px; }
        .freeze-active { background: var(--freeze); color: #000; font-weight: bold; }
        .history-box { margin-top: 15px; border-top: 1px solid #333; padding-top: 10px; max-height: 120px; overflow-y: auto; }
        .history-item { font-size: 11px; padding: 8px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body onclick="resumeAudio()">

<button id="menu-toggle" onclick="toggleSidebar()">â˜°</button>
<div id="sidebar" class="sidebar">
    
    <div class="menu-dropdown">
        <button class="dropdown-header-btn" onclick="toggleDropdown('settingsList')">âš™ï¸ <span data-key="settings_btn">Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</span></button>
        <div id="settingsList" class="dropdown-list">
            <div class="setting-row"><span class="setting-label" data-key="s_alert">Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Ø±Ø¯Ù†Û•ÙˆÛ•</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('alert-ui-section')"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_quick">Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø®ÛØ±Ø§</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('quick-conv-section')"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_trend">Ú•ÛÚ˜Û•ÛŒ Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ</span><label class="switch"><input type="checkbox" checked onclick="toggleTrendVisibility()"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_calc">Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø³Ù‚Ø§Úµ</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('calc-ui-section')"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_v24">Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('v24-card')"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_v21">Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('v21-card')"><span class="slider"></span></label></div>
            <div class="setting-row"><span class="setting-label" data-key="s_v18">Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨</span><label class="switch"><input type="checkbox" checked onclick="toggleSectionVisibility('v18-card')"><span class="slider"></span></label></div>
        </div>
    </div>

    <div class="menu-dropdown">
        <button class="dropdown-header-btn" onclick="toggleDropdown('langList')">ğŸŒ <span data-key="languages_btn">Ø²Ù…Ø§Ù†Û•Ú©Ø§Ù†</span></button>
        <div id="langList" class="dropdown-list">
            <button class="sub-btn" onclick="changeLanguage('ku')">Ú©ÙˆØ±Ø¯ÛŒ</button>
            <button class="sub-btn" onclick="changeLanguage('ar')">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</button>
            <button class="sub-btn" onclick="changeLanguage('en')">English</button>
            <button class="sub-btn" onclick="changeLanguage('tr')">TÃ¼rkÃ§e</button>
        </div>
    </div>

    <div class="menu-dropdown">
        <button class="dropdown-header-btn" onclick="toggleDropdown('soundList')">ğŸ”” <span data-key="sounds_btn">Ø¯Û•Ù†Ú¯Û•Ú©Ø§Ù†</span></button>
        <div id="soundList" class="dropdown-list">
            <button class="sub-btn" id="s1" onclick="changeSound(1, true)" data-key="sound_1">Ø²Û•Ù†Ú¯ÛŒ Ù…Û†Ø¯ÛØ±Ù†</button>
            <button class="sub-btn" id="s2" onclick="changeSound(2, true)" data-key="sound_2">Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Û•Ø±Û•ÙˆÛ•</button>
            <button class="sub-btn" id="s3" onclick="changeSound(3, true)" data-key="sound_3">Ø²Û•Ù†Ú¯ÛŒ Ú©Ø±ÛŒØ³ØªØ§Úµ</button>
        </div>
    </div>

    <button onclick="toggleSidebar()" data-key="close" style="margin-top: 30px; width: 100%; padding: 12px; border-radius: 12px; background: var(--gold); border: none; font-weight: bold; cursor:pointer;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
</div>

<div id="chartModal" class="chart-modal">
    <div class="chart-box">
        <button class="close-chart" onclick="toggleChart()">âœ•</button>
        <div id="tv_chart_container" style="height: 100%;"></div>
    </div>
</div>

<div class="box">
    <button onclick="document.body.classList.toggle('light-mode')" style="position:absolute; left:15px; top:15px; background:none; border:none; cursor:pointer; font-size:18px;">ğŸŒ“</button>
    <div class="header">
        <h2 data-key="title">Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ•</h2>
        <button class="chart-btn-icon" onclick="toggleChart()">ğŸ“Š</button>
    </div>
    <p id="live-clock" class="live-clock">--:--:--</p>
    
    <div class="status-bar">
        <button id="live-btn" class="btn-live" onclick="fetchGoldPrice()">Live ğŸ”´</button>
        <div style="display: flex; gap: 5px; align-items: center;">
            <button id="freeze-btn" class="freeze-btn" onclick="toggleFreeze()" data-key="freeze">â„ï¸ Ø¨Û•Ø³ØªÙ†</button>
            <div class="market-btn" onclick="document.getElementById('daysModal').classList.toggle('active')">
                <div id="status-dot" class="status-dot"></div>
                <span id="market-text" data-key="market">Ø¨Û†Ø±Ø³Û•</span>
            </div>
        </div>
    </div>

    <div id="quick-conv-section" class="quick-conv">
        <label data-key="quick_conv_label" style="text-align: center; display: block; margin-bottom: 8px; font-size: 10px; color: var(--gold);">Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø®ÛØ±Ø§ (Ø¯Û†Ù„Ø§Ø± â‡„ Ø¯ÛŒÙ†Ø§Ø±)</label>
        <div class="conv-inputs">
            <input type="number" id="quick-usd" placeholder="$" oninput="convertQuick('usd')">
            <span style="font-size: 12px;">â‡„</span>
            <input type="number" id="quick-iqd" placeholder="Ø¯.Ú©" oninput="convertQuick('iqd')">
        </div>
    </div>

    <div id="alert-ui-section" class="alert-section">
        <button id="alert-type-btn" class="alert-type-btn" onclick="cycleAlertType()">Ø¦Û†Ù†Ø³Û•</button>
        <input type="number" id="alert-price" class="alert-input" placeholder="...">
        <span id="alert-status" style="font-size: 14px;">ğŸ””</span>
    </div>

    <div id="daysModal" class="days-modal">
        <div data-key="market_schedule" style="text-align: center; color: var(--gold); font-size: 15px; font-weight: bold; margin-bottom: 15px;">Ø®Ø´ØªÛ•ÛŒ Ø¨Û†Ø±Ø³Û•ÛŒ Ø¬ÛŒÙ‡Ø§Ù†ÛŒ</div>
        <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 8px 0; border-bottom: 1px solid #333;"><span data-key="mon_fri">Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û• - Ù‡Û•ÛŒÙ†ÛŒ</span> <span data-key="open" id="market-open-text" style="color:var(--up)">Ú©Ø±Ø§ÙˆÛ•ÛŒÛ•</span></div>
        <div style="display: flex; justify-content: space-between; font-size: 13px; padding: 8px 0;"><span data-key="sat_sun">Ø´Û•Ù…Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•</span> <span data-key="closed" id="market-closed-text" style="color:var(--down)">Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•</span></div>
        <button onclick="document.getElementById('daysModal').classList.remove('active')" data-key="close" style="width: 100%; margin-top: 15px; background: var(--gold); border: none; border-radius: 12px; cursor: pointer; padding: 10px; font-weight: bold;">Ø¯Ø§Ø®Ø³ØªÙ†</button>
    </div>

    <div class="grid">
        <div>
            <label>
                <span data-key="ounce_label">Ø¦Û†Ù†Ø³Û•</span> 
                <span id="trend-container"><span id="trend"></span><span id="diff-val" style="font-size: 10px;"></span></span>
            </label>
            <input type="number" id="ounce" step="0.01" oninput="update()">
        </div>
        <div><label data-key="dollar_label">Ù¡Ù Ù  Ø¯Û†Ù„Ø§Ø±</label><input type="number" id="dollar" oninput="autoPremium(); convertQuick('usd')"></div>
        <div class="full-width">
            <label data-key="premium_label">Ù…Û•Ø³Ø±Û•Ù + Ø­Û•ÙˆØ§ÚµÛ• ($)</label>
            <input type="number" id="premium" oninput="update()">
        </div>
    </div>

    <div class="results">
        <div id="v24-card" class="res-card"><span class="res-label" data-key="v24">Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤</span><span class="res-iqd" id="v24-iqd">0</span><span class="res-usd" id="v24-usd">$0</span></div>
        <div id="v21-card" class="res-card highlight"><span class="res-label" data-key="v21">Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡</span><span class="res-iqd" id="v21-iqd">0</span><span class="res-usd" id="v21-usd">$0</span></div>
        <div id="v18-card" class="res-card"><span class="res-label" data-key="v18">Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨</span><span class="res-iqd" id="v18-iqd">0</span><span class="res-usd" id="v18-usd">$0</span></div>
    </div>

    <div id="calc-ui-section" class="calc-section">
        <div class="grid" style="margin: 0; gap: 8px;">
            <div><label data-key="gram">Ú¯Ø±Ø§Ù…</label><input type="number" id="g-weight" placeholder="0" oninput="update()"></div>
            <div><label data-key="mithqal">Ù…Ø³Ù‚Ø§Úµ</label><input type="number" id="m-weight" placeholder="0" oninput="update()"></div>
            <div><label data-key="wage">Ø­Û•Ù‚ Ø¯Û•Ø³Øª</label><input type="number" id="work-cost" value="0" oninput="update()"></div>
            <div><label data-key="karat">Ø¹Û•ÛŒØ§Ø±</label><select id="calc-karat" onchange="update()"><option value="1">Ù¢Ù¤</option><option value="0.875" selected>Ù¢Ù¡</option><option value="0.75">Ù¡Ù¨</option></select></div>
        </div>
        <span id="weight-detail" class="weight-info">...</span>
        <div class="total-box">
            <button class="currency-toggle" onclick="toggleCurrency()">â‡„</button>
            <span id="total-val" style="color:var(--up); font-size: 20px; font-weight: bold;">0 Ø¯.Ú©</span>
            <button class="btn-share" onclick="shareResult()" data-key="share">ğŸ“¤ Ù‡Ø§ÙˆØ¨Û•Ø´Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø±Ø®</button>
            <div onclick="addToHistory()" data-key="save" style="margin-top: 12px; color:#666; font-size:10px; cursor:pointer; text-decoration: underline;">â• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ø¨Ú©Û•</div>
        </div>
    </div>

    <div id="history-container" class="history-box">
        <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span data-key="history_list" style="font-size:10px; color:#888;">Ù„ÛŒØ³ØªÛŒ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª:</span><button onclick="clearHistory()" data-key="clear" style="background:none; border:none; color:var(--down); font-size:9px; cursor:pointer;">Ø³Ú•ÛŒÙ†Û•ÙˆÛ•</button></div>
        <div id="history-list"></div>
    </div>
</div>

<script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
<script>
    let isFrozen = false, showInDollar = false, currentTotalIQD = 0, lastPrice = 0, currentLang = 'ku', selectedSound = 1, isAlertEnabled = true;
    let audioCtx = null;
    let alertType = 'ounce'; 
    let lastAlertFiredPrice = 0;

    function resumeAudio() {
        if (!audioCtx) {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        if (audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        // Ask for notification permission on first interaction
        if (Notification.permission === "default") {
            Notification.requestPermission();
        }
    }

    function cycleAlertType() {
        const btn = document.getElementById('alert-type-btn');
        const types = ['ounce', 'v24', 'v21', 'v18'];
        const labels = {
            ku: { ounce: 'Ø¦Û†Ù†Ø³Û•', v24: 'Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤', v21: 'Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡', v18: 'Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨' },
            ar: { ounce: 'Ø£ÙˆÙ†ØµØ©', v24: 'Ø¹ Ù¢Ù¤', v21: 'Ø¹ Ù¢Ù¡', v18: 'Ø¹ Ù¡Ù¨' },
            en: { ounce: 'Ounce', v24: 'K24', v21: 'K21', v18: 'K18' },
            tr: { ounce: 'Ons', v24: '24 Ayar', v21: '21 Ayar', v18: '18 Ayar' }
        };
        let idx = types.indexOf(alertType);
        alertType = types[(idx + 1) % types.length];
        btn.innerText = labels[currentLang][alertType];
        lastAlertFiredPrice = 0;
        resumeAudio();
    }

    function sendNotification(title, body) {
        if (Notification.permission === "granted") {
            new Notification(title, {
                body: body,
                icon: "https://cdn-icons-png.flaticon.com/512/2454/2454282.png"
            });
        }
    }

    function toggleSectionVisibility(sectionId) {
        const section = document.getElementById(sectionId);
        const isHidden = section.style.display === 'none';
        section.style.display = isHidden ? (sectionId === 'alert-ui-section' ? 'flex' : 'block') : 'none';
        if(sectionId === 'alert-ui-section') isAlertEnabled = !isHidden;
    }

    function toggleTrendVisibility() {
        const trendContainer = document.getElementById('trend-container');
        trendContainer.style.display = trendContainer.style.display === 'none' ? 'inline' : 'none';
    }

    function toggleChart() {
        const modal = document.getElementById('chartModal');
        modal.classList.toggle('active');
        if(modal.classList.contains('active')) {
            new TradingView.widget({
                "autosize": true, "symbol": "OANDA:XAUUSD", "interval": "H", "timezone": "Etc/UTC", "theme": "dark", "style": "1", "locale": "en", "toolbar_bg": "#f1f3f6", "enable_publishing": false, "hide_side_toolbar": false, "allow_symbol_change": true, "container_id": "tv_chart_container"
            });
        }
    }

    const translations = {
        ku: { title: "Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ•", settings_btn: "Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†", languages_btn: "Ø²Ù…Ø§Ù†Û•Ú©Ø§Ù†", sounds_btn: "Ø¯Û•Ù†Ú¯Û•Ú©Ø§Ù†", close: "Ø¯Ø§Ø®Ø³ØªÙ†", freeze: "â„ï¸ Ø¨Û•Ø³ØªÙ†", market: "Ø¨Û†Ø±Ø³Û•", quick_conv_label: "Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø®ÛØ±Ø§ (Ø¯Û†Ù„Ø§Ø± â‡„ Ø¯ÛŒÙ†Ø§Ø±)", alert_me: "Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ù… Ø¨Ú©Û• Ù„Û•:", market_schedule: "Ø®Ø´ØªÛ•ÛŒ Ø¨Û†Ø±Ø³Û•ÛŒ Ø¬ÛŒÙ‡Ø§Ù†ÛŒ", mon_fri: "Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û• - Ù‡Û•ÛŒÙ†ÛŒ", sat_sun: "Ø´Û•Ù…Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•", open: "Ú©Ø±Ø§ÙˆÛ•ÛŒÛ•", closed: "Ø¯Ø§Ø®Ø±Ø§ÙˆÛ•", ounce_label: "Ø¦Û†Ù†Ø³Û•", dollar_label: "Ù¡Ù Ù  Ø¯Û†Ù„Ø§Ø±", premium_label: "Ù…Û•Ø³Ø±Û•Ù + Ø­Û•ÙˆØ§ÚµÛ• ($)", v24: "Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤", v21: "Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡", v18: "Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨", gram: "Ú¯Ø±Ø§Ù…", mithqal: "Ù…Ø³Ù‚Ø§Úµ", wage: "Ø­Û•Ù‚ Ø¯Û•Ø³Øª", karat: "Ø¹Û•ÛŒØ§Ø±", share: "ğŸ“¤ Ù‡Ø§ÙˆØ¨Û•Ø´Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø±Ø®", save: "â• Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ø¨Ú©Û•", history_list: "Ù„ÛŒØ³ØªÛŒ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª:", clear: "Ø³Ú•ÛŒÙ†Û•ÙˆÛ•", mithqal_unit: "Ù…Ø³Ù‚Ø§Úµ", nod_unit: "Ù†Û†Ø¯", frozen_msg: "âœ… Ø¨Û•Ø³ØªØ±Ø§ÙˆÛ•", s_alert: "Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Ø±Ø¯Ù†Û•ÙˆÛ•", s_quick: "Ú¯Û†Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø®ÛØ±Ø§", s_trend: "Ú•ÛÚ˜Û•ÛŒ Ú¯Û†Ú•Ø§Ù†Ú©Ø§Ø±ÛŒ", s_calc: "Ù‡Û•Ú˜Ù…Ø§Ø±Ú©Ø±Ø¯Ù†ÛŒ Ù…Ø³Ù‚Ø§Úµ", s_v24: "Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤", s_v21: "Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡", s_v18: "Ù¾ÛŒØ´Ø§Ù†Ø¯Ø§Ù†ÛŒ Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨", sound_1: "Ø²Û•Ù†Ú¯ÛŒ Ù…Û†Ø¯ÛØ±Ù†", sound_2: "Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Û•Ø±Û•ÙˆÛ•", sound_3: "Ø²Û•Ù†Ú¯ÛŒ Ú©Ø±ÛŒØ³ØªØ§Úµ", alert_title: "Ø¦Ø§Ú¯Ø§Ø¯Ø§Ø±Ú©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ Ù†Ø±Ø®" },
        ar: { title: "Ø¨ÙˆØ±ØµØ© Ø§Ù„Ø°Ù‡Ø¨", settings_btn: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª", languages_btn: "Ø§Ù„Ù„ØºØ§Øª", sounds_btn: "Ø§Ù„Ø£ØµÙˆØ§Øª", close: "Ø¥ØºÙ„Ø§Ù‚", freeze: "â„ï¸ ØªØ¬Ù…ÙŠØ¯", market: "Ø§Ù„Ø¨ÙˆØ±ØµØ©", quick_conv_label: "ØªØ­ÙˆÙŠÙ„ Ø³Ø±ÙŠØ¹ (Ø¯ÙˆÙ„Ø§Ø± â‡„ Ø¯ÙŠÙ†Ø§Ø±)", alert_me: "Ù†Ø¨Ù‡Ù†ÙŠ Ø¹Ù†Ø¯:", market_schedule: "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙˆØ±ØµØ© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©", mon_fri: "Ø§Ù„Ø£Ø«Ù†ÙŠÙ† - Ø§Ù„Ø¬Ù…Ø¹Ø©", sat_sun: "Ø§Ù„Ø³Ø¨Øª - Ø§Ù„Ø£Ø­Ø¯", open: "Ù…ÙØªÙˆØ­", closed: "Ù…ØºÙ„Ù‚", ounce_label: "Ø£ÙˆÙ†ØµØ©", dollar_label: "Ù¡Ù Ù  Ø¯ÙˆÙ„Ø§Ø±", premium_label: "Ù…ØµØ±Ù + Ø­ÙˆØ§Ù„Ø© ($)", v24: "Ø¹ÙŠØ§Ø± Ù¢Ù¤", v21: "Ø¹ÙŠØ§Ø± Ù¢Ù¡", v18: "Ø¹ÙŠØ§Ø± Ù¡Ù¨", gram: "Ø¬Ø±Ø§Ù…", mithqal: "Ù…Ø«Ù‚Ø§Ù„", wage: "Ø£Ø¬ÙˆØ± Ø§Ù„ØµÙŠØ§ØºØ©", karat: "Ø¹ÙŠØ§Ø±", share: "ğŸ“¤ Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø³Ø¹Ø±", save: "â• Ø­ÙØ¸ Ø§Ù„Ù†ØªØ§Ø¦Ø¬", history_list: "Ø³Ø¬Ù„ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø§Øª:", clear: "Ù…Ø³Ø­", mithqal_unit: "Ù…Ø«Ù‚Ø§Ù„", nod_unit: "Ù†ÙˆØ¯", frozen_msg: "âœ… Ù…ØªØ¬Ù…Ø¯", s_alert: "ØªÙ†Ø¨ÙŠÙ‡Ø§Øª", s_quick: "Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹", s_trend: "Ù†Ø³Ø¨Ø© Ø§Ù„ØªØºÙŠÙŠØ±", s_calc: "Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø«Ù‚Ø§Ù„", s_v24: "Ø¹Ø±Ø¶ Ø¹ÙŠØ§Ø± Ù¢Ù¤", s_v21: "Ø¹Ø±Ø¶ Ø¹ÙŠØ§Ø± Ù¢Ù¡", s_v18: "Ø¹Ø±Ø¶ Ø¹ÙŠØ§Ø± Ù¡Ù¨", sound_1: "Ø±Ù†Ø© Ù…ÙˆØ¯Ø±Ù†", sound_2: "Ø±Ù†Ø© ØªÙ†Ø¨ÙŠÙ‡", sound_3: "Ø±Ù†Ø© ÙƒØ±ÙŠØ³ØªØ§Ù„", alert_title: "ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ø³Ø¹Ø±" },
        en: { title: "Gold Exchange", settings_btn: "Settings", languages_btn: "Languages", sounds_btn: "Sounds", close: "Close", freeze: "â„ï¸ Freeze", market: "Market", quick_conv_label: "Quick Conv (USD â‡„ IQD)", alert_me: "Alert me at:", market_schedule: "Global Market Schedule", mon_fri: "Mon - Fri", sat_sun: "Sat - Sun", open: "Open", closed: "Closed", ounce_label: "Ounce", dollar_label: "$100 Rate", premium_label: "Premium + Transfer ($)", v24: "Karat 24", v21: "Karat 21", v18: "Karat 18", gram: "Gram", mithqal: "Mithqal", wage: "Work Cost", karat: "Karat", share: "ğŸ“¤ Share Price", save: "â• Save Result", history_list: "History:", clear: "Clear", mithqal_unit: "Mithqal", nod_unit: "Nod", frozen_msg: "âœ… Frozen", s_alert: "Alerts", s_quick: "Quick Conversion", s_trend: "Trend Percentage", s_calc: "Weight Calculator", s_v24: "Show Karat 24", s_v21: "Show Karat 21", s_v18: "Show Karat 18", sound_1: "Modern Sound", sound_2: "Alert Sound", sound_3: "Crystal Sound", alert_title: "Price Alert" },
        tr: { title: "AltÄ±n BorsasÄ±", settings_btn: "Ayarlar", languages_btn: "Diller", sounds_btn: "Sesler", close: "Kapat", freeze: "â„ï¸ Dondur", market: "Borsa", quick_conv_label: "HÄ±zlÄ± DÃ¶nÃ¼ÅŸtÃ¼r (USD â‡„ IQD)", alert_me: "Beni uyar:", market_schedule: "KÃ¼resel Borsa Takvimi", mon_fri: "Pazartesi - Cuma", sat_sun: "Cumartesi - Pazar", open: "AÃ§Ä±k", closed: "KapalÄ±", ounce_label: "Ons", dollar_label: "$100 Kuru", premium_label: "Masraf + Havale ($)", v24: "24 Ayar", v21: "21 Ayar", v18: "18 Ayar", gram: "Gram", mithqal: "Miskal", wage: "Ä°ÅŸÃ§ilik", karat: "Ayar", share: "ğŸ“¤ FiyatÄ± PaylaÅŸ", save: "â• Kaydet", history_list: "KayÄ±t GeÃ§miÅŸi:", clear: "Temizle", mithqal_unit: "Miskal", nod_unit: "Nod", frozen_msg: "âœ… Donduruldu", s_alert: "UyarÄ±lar", s_quick: "HÄ±zlÄ± DÃ¶nÃ¼ÅŸÃ¼m", s_trend: "DeÄŸiÅŸim OranÄ±", s_calc: "Miskal Hesaplama", s_v24: "24 AyarÄ± GÃ¶ster", s_v21: "21 AyarÄ± GÃ¶ster", s_v18: "18 AyarÄ± GÃ¶ster", sound_1: "Modern Zil", sound_2: "UyarÄ± Zili", sound_3: "Kristal Zil", alert_title: "Fiyat UyarÄ±sÄ±" }
    };

    function toggleDropdown(id) {
        resumeAudio();
        const list = document.getElementById(id);
        const isOpen = list.classList.contains('show');
        document.querySelectorAll('.dropdown-list').forEach(d => d.classList.remove('show'));
        if(!isOpen) list.classList.add('show');
    }

    function toggleSidebar() { 
        resumeAudio();
        document.getElementById('sidebar').classList.toggle('active'); 
        if(!document.getElementById('sidebar').classList.contains('active')) document.querySelectorAll('.dropdown-list').forEach(d => d.classList.remove('show'));
    }

    function changeLanguage(lang) {
        currentLang = lang;
        document.documentElement.lang = lang;
        document.documentElement.dir = (lang === 'en' || lang === 'tr') ? 'ltr' : 'rtl';
        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.getAttribute('data-key');
            if (translations[lang][key]) el.innerText = translations[lang][key];
        });
        const labels = {
            ku: { ounce: 'Ø¦Û†Ù†Ø³Û•', v24: 'Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤', v21: 'Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡', v18: 'Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨' },
            ar: { ounce: 'Ø£ÙˆÙ†ØµØ©', v24: 'Ø¹ Ù¢Ù¤', v21: 'Ø¹ Ù¢Ù¡', v18: 'Ø¹ Ù¡Ù¨' },
            en: { ounce: 'Ounce', v24: 'K24', v21: 'K21', v18: 'K18' },
            tr: { ounce: 'Ons', v24: '24 Ayar', v21: '21 Ayar', v18: '18 Ayar' }
        };
        document.getElementById('alert-type-btn').innerText = labels[lang][alertType];
        update(); 
    }

    function changeSound(id, preview = false) {
        selectedSound = id;
        document.querySelectorAll('#soundList .sub-btn').forEach(b => b.classList.remove('active-item'));
        document.getElementById('s' + id).classList.add('active-item');
        if(preview) {
            resumeAudio();
            setTimeout(playAlertSound, 50);
        }
    }

    function playAlertSound() {
        if (!isAlertEnabled || !audioCtx) return;
        const now = audioCtx.currentTime;
        const gainNode = audioCtx.createGain(); 
        gainNode.connect(audioCtx.destination);
        const playTone = (freq, type, startOffset, duration, volume) => {
            const osc = audioCtx.createOscillator(); 
            osc.type = type; 
            osc.frequency.setValueAtTime(freq, now + startOffset);
            osc.connect(gainNode); 
            gainNode.gain.setValueAtTime(0, now + startOffset);
            gainNode.gain.linearRampToValueAtTime(volume, now + startOffset + 0.01);
            gainNode.gain.exponentialRampToValueAtTime(0.0001, now + startOffset + duration);
            osc.start(now + startOffset); 
            osc.stop(now + startOffset + duration);
        };
        if(selectedSound === 1) { 
            playTone(880, 'sine', 0, 0.5, 0.2); 
            playTone(698.46, 'sine', 0.1, 0.6, 0.15); 
        } else if(selectedSound === 2) { 
            playTone(1046.50, 'triangle', 0, 0.3, 0.2); 
            playTone(1318.51, 'sine', 0.05, 0.3, 0.1); 
        } else { 
            playTone(1567.98, 'sine', 0, 0.8, 0.15); 
            playTone(2093.00, 'sine', 0.05, 0.8, 0.05); 
        }
    }

    function toggleFreeze() { isFrozen = !isFrozen; const btn = document.getElementById('freeze-btn'); btn.classList.toggle('freeze-active'); btn.innerText = isFrozen ? translations[currentLang].frozen_msg : translations[currentLang].freeze; }
    function toggleCurrency() { showInDollar = !showInDollar; update(); }
    function autoPremium() { if(isFrozen) return; const dollar = parseFloat(document.getElementById('dollar').value) || 0; let diff = (dollar - 148900) / 1000; document.getElementById('premium').value = (220 + (diff * 2.5)).toFixed(1); update(); }
    function convertQuick(type) { const dollarRate = parseFloat(document.getElementById('dollar').value) / 100 || 0; const usdIn = document.getElementById('quick-usd'), iqdIn = document.getElementById('quick-iqd'); if (dollarRate === 0) return; if (type === 'usd') iqdIn.value = (usdIn.value * dollarRate).toFixed(0); else usdIn.value = (iqdIn.value / dollarRate).toFixed(2); }
    
    async function fetchGoldPrice() { 
        if(isFrozen) return; 
        try { 
            const res = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT'); 
            const data = await res.json(); const price = parseFloat(data.price); 
            if (price > 0) { 
                const trend = document.getElementById('trend'), diffEl = document.getElementById('diff-val');
                if(lastPrice > 0 && price !== lastPrice) {
                    const diff = price - lastPrice, percent = (diff / lastPrice) * 100;
                    trend.innerHTML = diff > 0 ? "â–²" : "â–¼"; trend.style.color = diff > 0 ? "var(--up)" : "var(--down)";
                    diffEl.innerText = `${diff > 0 ? "+" : ""}${diff.toFixed(2)} (${percent.toFixed(2)}%)`;
                    diffEl.style.color = diff > 0 ? "var(--up)" : "var(--down)";
                }
                lastPrice = price; document.getElementById('ounce').value = price.toFixed(2); 
                update(); 
                checkAlert(); 
            } 
        } catch (e) {} 
    }
    
    function checkAlert() {
        if (!isAlertEnabled) return;
        const targetPrice = parseFloat(document.getElementById('alert-price').value);
        const statusIcon = document.getElementById('alert-status');
        if (!targetPrice || targetPrice <= 0) { statusIcon.style.color = "inherit"; return; }
        let currentVal = 0;
        let typeName = document.getElementById('alert-type-btn').innerText;
        if (alertType === 'ounce') {
            currentVal = parseFloat(document.getElementById('ounce').value);
        } else {
            currentVal = parseFloat(document.getElementById(`${alertType}-iqd`).innerText.replace(/,/g, ''));
        }
        const threshold = (alertType === 'ounce') ? 0.3 : 500;
        if (Math.abs(currentVal - targetPrice) <= threshold) {
            if (Math.abs(currentVal - lastAlertFiredPrice) > threshold) {
                statusIcon.style.color = "var(--up)"; 
                playAlertSound(); 
                sendNotification(translations[currentLang].alert_title, `${typeName}: ${currentVal.toLocaleString()}`);
                if (window.navigator.vibrate) window.navigator.vibrate([300, 100, 300]);
                lastAlertFiredPrice = currentVal;
            }
        } else {
            statusIcon.style.color = "inherit";
            if (Math.abs(currentVal - lastAlertFiredPrice) > threshold * 10) {
                lastAlertFiredPrice = 0;
            }
        }
    }

    function update() {
        const ounce = parseFloat(document.getElementById('ounce').value) || 0, dollar = parseFloat(document.getElementById('dollar').value) || 0, premium = parseFloat(document.getElementById('premium').value) || 0, workCost = parseFloat(document.getElementById('work-cost').value) || 0, exRate = dollar / 100;
        if (ounce > 0 && dollar > 0) {
            const m24_iqd = ((ounce + premium) / 31.1034 * 5) * exRate;
            const setRes = (id, r) => {
                const iqd = Math.round((m24_iqd * r) / 250) * 250;
                document.getElementById(id + '-iqd').innerText = iqd.toLocaleString();
                document.getElementById(id + '-usd').innerText = "$" + (iqd / exRate).toFixed(2);
            };
            setRes('v24', 1); setRes('v21', 0.875); setRes('v18', 0.75);
            const totalM = (parseFloat(document.getElementById('m-weight').value) || 0) + ((parseFloat(document.getElementById('g-weight').value) || 0) / 5);
            document.getElementById('weight-detail').innerText = `${Math.floor(totalM)} ${translations[currentLang].mithqal_unit} & ${Math.round((totalM % 1) * 100)} ${translations[currentLang].nod_unit}`;
            currentTotalIQD = (m24_iqd * parseFloat(document.getElementById('calc-karat').value) * totalM) + (workCost * totalM);
            const el = document.getElementById('total-val'), currency = (currentLang === 'en' || currentLang === 'tr') ? ' IQD' : (currentLang === 'ar' ? ' Ø¯.Ø¹' : ' Ø¯.Ú©');
            if (showInDollar) el.innerText = "$" + (currentTotalIQD / exRate).toFixed(2);
            else el.innerText = (Math.round(currentTotalIQD / 250) * 250).toLocaleString() + currency;
        }
    }

    function shareResult() { const text = `ğŸ’° ${document.getElementById('total-val').innerText}\nğŸŒ Ø¦Û†Ù†Ø³Û•: $${document.getElementById('ounce').value}`; navigator.clipboard.writeText(text).then(() => alert('Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§')); }
    function addToHistory() { const val = document.getElementById('total-val').innerText, weight = document.getElementById('weight-detail').innerText; if(currentTotalIQD === 0) return; let history = JSON.parse(localStorage.getItem('gold_history') || '[]'); history.unshift({ weight, val }); history = history.slice(0, 10); localStorage.setItem('gold_history', JSON.stringify(history)); renderHistory(); }
    function renderHistory() { const history = JSON.parse(localStorage.getItem('gold_history') || '[]'); const list = document.getElementById('history-list'); list.innerHTML = ''; history.forEach(item => { const div = document.createElement('div'); div.className = 'history-item'; div.innerHTML = `<span>${item.weight}</span> <strong>${item.val}</strong>`; list.appendChild(div); }); }
    function clearHistory() { localStorage.removeItem('gold_history'); renderHistory(); }

    setInterval(() => {
        document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-GB');
        const d = new Date(), dot = document.getElementById('status-dot'), text = document.getElementById('market-text');
        const openTxt = document.getElementById('market-open-text'), closedTxt = document.getElementById('market-closed-text');
        if(openTxt) openTxt.innerText = translations[currentLang].open;
        if(closedTxt) closedTxt.innerText = translations[currentLang].closed;
        if (d.getDay() === 6 || d.getDay() === 0) { dot.className = "status-dot dot-closed"; text.innerText = translations[currentLang].closed; } 
        else { dot.className = "status-dot dot-open"; text.innerText = translations[currentLang].open; }
    }, 1000);

    window.onload = () => { 
        document.getElementById('dollar').value = "150000"; 
        changeLanguage('ku'); 
        changeSound(1); 
        autoPremium(); 
        fetchGoldPrice(); 
        renderHistory(); 
        setInterval(fetchGoldPrice, 3000); 
    };
</script>
</body>
</html>
