<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2489/2489756.png">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Û†Ø±Ø³Û•ÛŒ Ø²ÛÚ• | Live</title>
    <style>
        :root {
            --gold: #d4af37; --bg: #0d0d0d; --card: #1a1a1a;
            --input-bg: #000; --text: #fff; --up: #00ff88; --down: #ff4d4d;
        }

        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; padding: 10px; }
        .box { background: var(--card); padding: 25px; border-radius: 30px; width: 100%; max-width: 400px; border: 1px solid rgba(212, 175, 55, 0.2); box-shadow: 0 30px 60px rgba(0,0,0,0.7); position: relative; }
        .header { text-align: center; margin-bottom: 20px; }
        .header h2 { color: var(--gold); margin: 0; font-size: 28px; }
        
        .status-bar { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        .api-status { font-size: 11px; color: #888; cursor: pointer; border: 1px solid #333; padding: 5px 12px; border-radius: 20px; background: #111; }
        .market-info { font-size: 10px; color: var(--gold); cursor: help; border-bottom: 1px dashed var(--gold); }

        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 20px; }
        .full-width { grid-column: span 2; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; border: 1px solid #333; border-radius: 12px; background: var(--input-bg); color: #fff; font-size: 16px; text-align: center; outline: none; box-sizing: border-box; }
        input:focus { border-color: var(--gold); }

        .results { border-radius: 20px; overflow: hidden; background: rgba(0,0,0,0.3); margin-bottom: 15px; }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; border-bottom: 1px solid #222; }
        .row.active { background: rgba(212, 175, 55, 0.1); border-right: 4px solid var(--gold); }
        
        .price-container { text-align: left; display: flex; flex-direction: column; align-items: flex-end; }
        .val-iqd { font-family: 'Consolas', monospace; font-size: 17px; font-weight: bold; transition: color 0.4s; }
        .val-usd { font-family: 'Consolas', monospace; font-size: 13px; color: var(--gold); opacity: 0.8; }

        .trend-up { color: var(--up) !important; }
        .trend-down { color: var(--down) !important; }

        .share-group { display: flex; gap: 10px; margin-top: 15px; }
        .btn { flex: 1; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-gold { background: var(--gold); color: #000; }
        .btn-outline { background: #333; color: var(--gold); }
        
        #marketModal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #222; padding: 20px; border-radius: 20px; border: 1px solid var(--gold); z-index: 100; width: 80%; max-width: 300px; text-align: center; box-shadow: 0 0 100px rgba(0,0,0,0.8); }
        #overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 90; }
    </style>
</head>
<body>

<div id="overlay" onclick="closeModal()"></div>
<div id="marketModal">
    <h3 style="color:var(--gold); margin-top:0;">Ú©Ø§ØªÛŒ Ø¨Û†Ø±Ø³Û•</h3>
    <p style="font-size:13px; line-height:1.6;">ğŸ“… <b>Ø¯ÙˆÙˆØ´Û•Ù…Ù…Û• - Ù‡Û•ÛŒÙ†ÛŒ:</b><br>Ù¢Ù¤ Ú©Ø§ØªÚ˜Ù…ÛØ± Ú©Ø±Ø§ÙˆÛ•ÛŒÛ•</p>
    <p style="font-size:13px; line-height:1.6; color:#ff4d4d;">ğŸš« <b>Ø´Û•Ù…Ù…Û• - ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û•:</b><br>Ø¯Ø§Ø®Ø±Ø§ÙˆÛ• (Ù¾Ø´ÙˆÙˆ)</p>
    <p style="font-size:11px; color:#888;">Ú©Ø±Ø§Ù†Û•ÙˆÛ•: ÛŒÛ•Ú©Ø´Û•Ù…Ù…Û• Ú©Ø§ØªÚ˜Ù…ÛØ± Ù Ù¢:Ù Ù ÛŒ Ø´Û•Ùˆ</p>
    <button class="btn btn-gold" style="margin-top:10px; padding:8px;" onclick="closeModal()">Ø¨Ø§Ø´Û•</button>
</div>

<div class="box">
    <div class="header">
        <h2>Ø¨Û†Ø±Ø³Û•ÛŒ Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†</h2>
        <p id="live-clock" style="font-size: 12px; color: #666; margin: 5px 0;">--:--:--</p>
        <div class="status-bar">
            <div id="api-btn" class="api-status" onclick="fetchGoldPrice()">Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ• ğŸ”„</div>
            <div class="market-info" onclick="showModal()">Ú©Ø§ØªÛŒ Ø¨Û†Ø±Ø³Û• ğŸ•’</div>
        </div>
    </div>

    <div class="grid">
        <div>
            <label>Ø¦Û†Ù†Ø³Û• ($)</label>
            <input type="number" id="ounce" step="any" oninput="update()">
        </div>
        <div>
            <label>Ù¡Ù Ù  Ø¯Û†Ù„Ø§Ø± (Ø¯ÛŒÙ†Ø§Ø±)</label>
            <input type="number" id="dollar" step="any" oninput="update()">
        </div>
        <div class="full-width">
            <label>Ø­Û•ÙˆØ§ÚµÛ•/Ù…Û•Ø³Ø±Û•Ù ($)</label>
            <input type="number" id="premium" value="81" oninput="update()">
        </div>
    </div>

    <div class="results">
        <div class="row"><span>Ø¹Û•ÛŒØ§Ø± Ù¢Ù¤:</span><div class="price-container"><span class="val-iqd" id="v24-iqd">0</span><span class="val-usd" id="v24-usd">0</span></div></div>
        <div class="row active"><span>Ø¹Û•ÛŒØ§Ø± Ù¢Ù¡:</span><div class="price-container"><span class="val-iqd" id="v21-iqd">0</span><span class="val-usd" id="v21-usd">0</span></div></div>
        <div class="row"><span>Ø¹Û•ÛŒØ§Ø± Ù¡Ù¨:</span><div class="price-container"><span class="val-iqd" id="v18-iqd">0</span><span class="val-usd" id="v18-usd">0</span></div></div>
    </div>

    <div class="share-group">
        <button class="btn btn-gold" onclick="copyRates()">Ú©Û†Ù¾ÛŒ Ù†Ø±Ø® ğŸ“‹</button>
        <button class="btn btn-outline" onclick="resetDefaults()">Reset ğŸ”„</button>
    </div>
</div>

<script>
    let lastM21 = 0;

    function showModal() { document.getElementById('marketModal').style.display = 'block'; document.getElementById('overlay').style.display = 'block'; }
    function closeModal() { document.getElementById('marketModal').style.display = 'none'; document.getElementById('overlay').style.display = 'none'; }

    async function fetchGoldPrice() {
        const btn = document.getElementById('api-btn');
        const day = new Date().getDay();
        const hour = new Date().getHours();

        if (day === 6 || (day === 0 && hour < 2) || (day === 5 && hour >= 23)) {
            btn.innerText = "Ø¨Û†Ø±Ø³Û• Ø¯Ø§Ø®Ø±Ø§ÙˆÛ• ğŸ’¤";
        } else {
            btn.innerText = "Ù†ÙˆÛ Ø¯Û•Ø¨ÛØªÛ•ÙˆÛ•...";
        }

        try {
            const response = await fetch('https://api.binance.com/api/v3/ticker/price?symbol=PAXGUSDT');
            const data = await response.json();
            if(data.price) {
                document.getElementById('ounce').value = parseFloat(data.price).toFixed(2);
                update();
                if (!(day === 6 || (day === 0 && hour < 2))) btn.innerText = "Ù†ÙˆÛÚ©Ø±Ø§ÛŒÛ•ÙˆÛ• âœ…";
            }
        } catch (e) { btn.innerText = "Ù‡Û•ÚµÛ• âŒ"; }
        setTimeout(() => btn.innerText = "Ù†ÙˆÛÚ©Ø±Ø¯Ù†Û•ÙˆÛ• ğŸ”„", 3000);
    }

    function update() {
        const ounce = parseFloat(document.getElementById('ounce').value) || 0;
        const dollar = parseFloat(document.getElementById('dollar').value) || 0;
        const premium = parseFloat(document.getElementById('premium').value) || 0;
        localStorage.setItem('data', JSON.stringify({ounce, dollar, premium}));

        if (ounce > 0 && dollar > 0) {
            const exchangeRate = dollar / 100;
            // Ø¯Û†Ø²ÛŒÙ†Û•ÙˆÛ•ÛŒ Ù†Ø±Ø®ÛŒ Ù…Ø³Ù‚Ø§ÚµÛŒ Ù¢Ù¤ Ø¨Û• Ø¯ÛŒÙ†Ø§Ø±
            const m24_iqd_raw = ((ounce + premium) / 31.10347 * 5) * exchangeRate;

            function setAndDisplay(id, ratio) {
                const iqdVal = (Math.round((m24_iqd_raw * ratio) / 250) * 250);
                // Ú¯Ø±Ù†Ú¯ØªØ±ÛŒÙ† Ø¨Û•Ø´: Ù„ÛØ±Û• Ø¯Û†Ù„Ø§Ø±Û•Ú©Û• Ø¯Ø§Ø¨Û•Ø´ÛŒ Ø³Û•Ø±ÙÛŒ Ú•Û†Ú˜ Ø¯Û•Ú©Ø±ÛØªÛ•ÙˆÛ• ØªØ§ÙˆÛ•Ú©Ùˆ Ù„Û•Ú¯Û•Úµ Ø¯Û†Ù„Ø§Ø±Û•Ú©Û• Ø¨Ú¯Û†Ú•ÛØª
                const usdVal = iqdVal / exchangeRate;

                document.getElementById(id + '-iqd').innerText = iqdVal.toLocaleString() + " Ø¯.Ú©";
                document.getElementById(id + '-usd').innerText = "$" + usdVal.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                if(id === 'v21') {
                    handleTrend('v21-iqd', iqdVal, lastM21);
                    lastM21 = iqdVal;
                }
            }

            setAndDisplay('v24', 1);
            setAndDisplay('v21', 0.875);
            setAndDisplay('v18', 0.75);
        }
    }

    function handleTrend(id, newVal, oldVal) {
        const el = document.getElementById(id);
        if (oldVal > 0) {
            el.classList.remove('trend-up', 'trend-down');
            if (newVal > oldVal) el.classList.add('trend-up');
            else if (newVal < oldVal) el.classList.add('trend-down');
            setTimeout(() => el.classList.remove('trend-up', 'trend-down'), 1000);
        }
    }

    function copyRates() {
        const t = `ğŸ“Š Ù†Ø±Ø®Û•Ú©Ø§Ù†ÛŒ Ø²ÛÚ•:\nØ¹Û•ÛŒØ§Ø± Ù¢Ù¡: ${document.getElementById('v21-iqd').innerText} (${document.getElementById('v21-usd').innerText})\nØ¦Û†Ù†Ø³Û•: $${document.getElementById('ounce').value}\nØ¨Û†Ø±Ø³Û•ÛŒ Ú©ÙˆØ±Ø¯Ø³ØªØ§Ù†`;
        navigator.clipboard.writeText(t);
        alert("Ú©Û†Ù¾ÛŒ Ú©Ø±Ø§!");
    }

    function resetDefaults() { if(confirm("Ø¯ÚµÙ†ÛŒØ§ÛŒØŸ")) { localStorage.clear(); location.reload(); } }

    setInterval(() => { document.getElementById('live-clock').innerText = new Date().toLocaleTimeString('en-GB'); }, 1000);

    window.onload = () => {
        const saved = JSON.parse(localStorage.getItem('data'));
        if(saved) {
            document.getElementById('ounce').value = saved.ounce;
            document.getElementById('dollar').value = saved.dollar;
            document.getElementById('premium').value = saved.premium;
        }
        update();
        fetchGoldPrice();
    };
</script>
</body>
</html>
